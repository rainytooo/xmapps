<% content_for :head do %>
<%= stylesheet_link_tag('jquery.Jcrop.css') %>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
<%= javascript_include_tag 'jquery.Jcrop.min.js' %>
<script language="Javascript">
    jQuery(function() {
        jQuery('#cropbox').Jcrop({
            onSelect: update_crop,
            onChange: update_crop,
			setSelect: [0, 0, 200, 200],
			aspectRatio: 1
        });
    });	
function update_crop(coords) {
  var rx = 100/coords.w;
  var ry = 100/coords.h;
  $('#preview').css({
    width: Math.round(rx * <%= @dl_thread.photo_geometry(:medium).width %>) + 'px',
    height: Math.round(ry * <%= @dl_thread.photo_geometry(:medium).height %>) + 'px',
    marginLeft: '-' + Math.round(rx * coords.x) + 'px',
    marginTop: '-' + Math.round(ry * coords.y) + 'px'
  });
  var ratio = <%= @dl_thread.photo_geometry(:original).width %> / <%= @dl_thread.photo_geometry(:medium).width %>;
  $("#crop_x").val(Math.round(coords.x * ratio));
  $("#crop_y").val(Math.round(coords.y * ratio));
  $("#crop_w").val(Math.round(coords.w * ratio));
  $("#crop_h").val(Math.round(coords.h * ratio));
}	
</script>
<% end %>
		<div class="content_container">
			<div class="page_path">
			<a href="#" title="">首页</a> &gt;&gt; <%= link_to '资源下载', downloads_dl_threads_path %> &gt;&gt; <%= @dl_thread.name %>
			</div><!-- .page_path -->
			<div class="page_title"><h1><%= @dl_thread.name %></h1></div>
			
			<div class="form_info_container">
				<div class="form_info_desc"><%= @dl_thread.name %>的详细信息</div><!-- .form_desc -->
				<div class="form_info_left">
					<%= image_tag @dl_thread.photo.url(:medium), :id => 'cropbox' %>
					<h4>Preview:</h4>
					<div style="width:100px; height:100px; overflow:hidden">
					  <%= image_tag @dl_thread.photo.url(:medium), :id => "preview" %>
					</div>
					<p><label>资源名称:</label><%= @dl_thread.name %></p>
					<% form_for( [:downloads, @dl_thread] ) do |f| %>
					  <% for attribute in [:crop_x, :crop_y, :crop_w, :crop_h] %>
						<%= f.hidden_field attribute, :id => attribute %>
					  <% end %>
					  <p><%= f.submit "Crop" %></p>
					<% end %>
					
					
					
					
				
				</div><!-- .form_info_left -->
				
				
			</div><!-- .form_info_container -->
		</div><!-- #content_container -->
		<div class="clear"></div>

<%= link_to 'Edit', edit_downloads_dl_thread_path(@dl_thread) %> |
<%= link_to 'Back', downloads_dl_threads_path %>
